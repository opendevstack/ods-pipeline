// Document generated by internal/documentation/tasks.go from template.adoc.tmpl; DO NOT EDIT.

= ods-build-go-with-sidecar

Builds Go (module) applications.

The exact build recipe can be found at
link:https://github.com/opendevstack/ods-pipeline/blob/master/build/package/scripts/build-go.sh[build/package/scripts/build-go.sh].

The following provides an overview of the performed steps:

- Source files are checked to be formatted with `gofmt`.
- `golanci-lint` is run, generating a report which is placed into
  `.ods/artifacts/lint-reports`. The linter can be configured via a
  config file as described in the
  link:https://golangci-lint.run/usage/configuration/[configuration documentation].
- Tests are executed. A potential `vendor` directory is excluded. Test
  results are converted into xUnit format, and placed together with coverage
  report into `.ods/artifacts`. If test artifacts are already present for
  the current Git commit SHA, testing is skipped.
- Application binary (named `app`) is built and placed into the directory
  specified by `output-dir`.

Finally, the application source code is scanned by SonarQube.
Default SonarQube project properties are provided unless `sonar-project.properties`
is present.
When `sonar-quality-gate` is set to `true`, the task will fail if the quality gate
is not passed. If SonarQube is not desired, it can be disabled via `sonar-skip`.
The SonarQube scan will include parameters to perform a pull request analysis if
there is an open pull request for the branch being built. If the
link:https://docs.sonarqube.org/latest/analysis/bitbucket-integration/[ALM integration]
is setup properly, pull request decoration in Bitbucket is done automatically.

**Sidecar variant!** Use this task if you need to run a container next to the build task.
For example, this could be used to run a database to allow for integration tests.
The sidecar image to must be supplied via `sidecar-image`.
Apart from the sidecar, the task is an exact copy of `ods-build-go`.

== Parameters

[cols="1,1,2"]
|===
| Parameter | Default | Description

| working-dir
| .
| Working directory. The path must be relative to the root of the repository,
without leading `./` and trailing `/`.



| enable-cgo
| false
| Whether to enable CGO. When not enabled the build will set `CGO_ENABLED=0`.


| go-os
| linux
| `GOOS` variable (the execution operating system such as `linux`, `windows`).


| go-arch
| amd64
| `GOARCH` variable (the execution architecture such as `arm`, `amd64`).


| output-dir
| docker
| Path to the directory into which the resulting Go binary should be copied, relative to `working-dir`. This directory may then later be used as Docker context for example.


| pre-test-script
| 
| Script to execute before running tests, relative to the working directory.


| sonar-quality-gate
| false
| Whether the SonarQube quality gate needs to pass for the task to succeed.


| sonar-skip
| false
| Whether to skip SonarQube analysis or not.


| sidecar-image
| 
| Image to use for sidecar

|===

== Artifacts

N/A

== Results

N/A
