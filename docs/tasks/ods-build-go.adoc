// Document generated by internal/documentation/tasks.go from template.adoc.tmpl; DO NOT EDIT.

= ods-build-go

Builds Go (module) applications.

The exact build recipe can be found at
link:https://github.com/opendevstack/ods-pipeline/blob/master/build/package/scripts/build-go.sh[build/package/scripts/build-go.sh].

The following provides an overview of the performed steps:

- Source files are checked to be formatted with `gofmt`.
- The go module cache is configured to be on the cache location of the PVC by setting environment variable `GOMODCACHE` to `.ods-cache/deps/gomod` (see link:https://go.dev/ref/mod#module-cache[go module cache]).
- `golanci-lint` is run. The linter can be configured via a
  config file as described in the
  link:https://golangci-lint.run/usage/configuration/[configuration documentation].
- Tests are executed. A potential `vendor` directory is excluded. Test
  results are converted into xUnit format.
- Application binary (named `app`) is built and placed into the directory
  specified by `output-dir`.

Finally, the application source code is scanned by SonarQube.
Default SonarQube project properties are provided unless `sonar-project.properties`
is present.
When `sonar-quality-gate` is set to `true`, the task will fail if the quality gate
is not passed. If SonarQube is not desired, it can be disabled via `sonar-skip`.
The SonarQube scan will include parameters to perform a pull request analysis if
there is an open pull request for the branch being built. If the
link:https://docs.sonarqube.org/latest/analysis/bitbucket-integration/[ALM integration]
is setup properly, pull request decoration in Bitbucket is done automatically.

The following artifacts are generated by the build task and placed into `.ods/artifacts/`

* `code-coverage/`
  ** `coverage.out`
* `lint-reports/`
  ** `report.txt`
* `sonarqube-analysis/`
  ** `analysis-report.md`
  ** `issues-report.csv`
  ** `quality-gate.json`
* `xunit-reports/`
  ** `report.xml`

Instead of the built-in script, one can also specify a build script located
in the Git repository using the `build-script` task parameter. This allows
full control of building and testing, including any generation of artifacts.
Note that some other task parameters have no effect when a custom build
script is used, unless they are handled properly in the script. At a
minimum, the custom script should place its outputs in the directory
identified by `output-dir`.


== Parameters

[cols="1,1,2"]
|===
| Parameter | Default | Description

| working-dir
| .
| Working directory. The path must be relative to the root of the repository,
without leading `./` and trailing `/`.



| enable-cgo
| false
| Whether to enable CGO. When not enabled the build will set `CGO_ENABLED=0`.


| go-os
| linux
| `GOOS` variable (the execution operating system such as `linux`, `windows`).


| go-arch
| amd64
| `GOARCH` variable (the execution architecture such as `arm`, `amd64`).


| output-dir
| docker
| Path to the directory into which the resulting Go binary should be copied, relative to `working-dir`. This directory may then later be used as Docker context for example.


| cache-build
| true
| If enabled tasks uses or populates cache with the output dir contents (and artifacts) so that a build can be skipped if the `working-dir` contents did not change. For single build repos enabling build caching has limited benefits. For multi build repos enabling this is recommended unless the build is dependant on files outside of the working directory. See ADR caching-build-tasks for more details and workarounds.


| build-script
| /usr/local/bin/build-go
| Build script to execute. The link:https://github.com/opendevstack/ods-pipeline/blob/master/build/package/scripts/build-go.sh[default script] is located in the container image. If you specify a relative path instead, it will be resolved from the workspace. See the task definition for details how the build script is invoked.


| pre-test-script
| 
| Script to execute before running tests, relative to the working directory.


| sonar-quality-gate
| false
| Whether the SonarQube quality gate needs to pass for the task to succeed.


| sonar-skip
| false
| Whether to skip SonarQube analysis or not.

|===

== Results

[cols="1,3"]
|===
| Name | Description

| build-reused-from-location
| The cache location that the build task used. If caching is not enabled this will be an empty string.

|===
