// Document generated by internal/documentation/tasks.go from template.adoc.tmpl; DO NOT EDIT.

= ods-build-typescript-with-sidecar

Builds Typescript applications.

The following steps are executed:

- checks that package.json and package-lock.json exists to require best practice of using lock files. See also link:https://github.com/opendevstack/ods-pipeline/discussions/411[discussion 411]
- linting using `eslint`
- build typescript application, using `npm run build`
- test execution
- SonarQube quality scan

For `eslint` to work there needs to be a config file (`eslintrc.json` or similar) at the root of the working directory.
This can be done by running `eslint --init` or by following the link:https://eslint.org/docs/user-guide/getting-started[official documentation]

The exact build recipe can be found at
link:https://github.com/opendevstack/ods-pipeline/blob/master/build/package/scripts/build-typescript.sh[build/package/scripts/build-typescript.sh].
In particular, `npm run build` is expected to place outputs into `dist`.

After tests ran successfully, the application source code is scanned by SonarQube.
Default SonarQube project properties are provided unless `sonar-project.properties`
is present.
When `sonar-quality-gate` is set to `true`, the task will fail if the quality gate
is not passed. If SonarQube is not desired, it can be disabled via `sonar-skip`.
The SonarQube scan will include parameters to perform a pull request analysis if
there is an open pull request for the branch being built. If the
link:https://docs.sonarqube.org/latest/analysis/bitbucket-integration/[ALM integration]
is setup properly, pull request decoration in Bitbucket is done automatically.

The following artifacts are generated by the build task and placed into `.ods/artifacts/`

* `code-coverage/`
  ** `clover.xml`
  ** `coverage-final.json`
  ** `lcov.info`
* `lint-reports`
  ** `report.txt`
* `sonarqube-analysis/`
  ** `analysis-report.md`
  ** `issues-report.csv`
  ** `quality-gate.json`
* `xunit-reports/`
  ** `report.xml`

**Sidecar variant!** Use this task if you need to run a container next to the build task.
For example, this could be used to run a database to allow for integration tests.
The sidecar image to must be supplied via `sidecar-image`.
Apart from the sidecar, the task is an exact copy of `ods-build-typescript`.

== Parameters

[cols="1,1,2"]
|===
| Parameter | Default | Description

| working-dir
| .
| Working directory. The path must be relative to the root of the repository,
without leading `./` and trailing `/`.



| output-dir
| docker
| Path to the directory into which outputs should be placed, relative to `working-dir`. This directory may then later be used as Docker context for example.


| cache-output-dir
| true
| If enabled tasks uses or populates cache with the output dir contents (and reports) so that a build can be skipped if the `working-dir` contents did not change.


| max-lint-warnings
| 0
| Maximum of allowed linting warnings after which eslint will exit with an error. Set to "-1" to never exit with an error due to warnings.


| lint-file-ext
| .js,.ts,.jsx,.tsx,.svelte
| File extensions to lint separated by a comma.


| sonar-quality-gate
| false
| Whether quality gate needs to pass.


| sonar-skip
| false
| Whether to skip the SonarQube analysis or not.


| node-version
| 16
| Node.js version to use - supported versions: 16


| build-dir
| dist
| Must match the directory into which `npm run build` places files. The files inside `build-dir` will be copied to the `dist` folder in `output-dir` As a result the files will be in `$output-dir/dist` Other common build directories are `build` and `public`.


| copy-node-modules
| false
| Whether `node-modules` is copied to the `output-dir` or not. If copied the node modules are in `$output-dir/dist/node_modules`. For frontend components this should be set to "false", while for backend components this should be set to "true".


| sidecar-image
| 
| Image to use for sidecar

|===

== Results

[cols="1,3"]
|===
| Name | Description

| build-reused-from-location
| The cache location that the build task used. If caching is not enabled this will be an empty string.

|===
