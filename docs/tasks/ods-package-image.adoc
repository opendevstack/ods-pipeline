// Document generated by internal/documentation/tasks.go from template.adoc.tmpl; DO NOT EDIT.

= ods-package-image

Packages applications into container images using
link:https://buildah.io[buildah].

buildah builds a container image from the `docker-dir` directory using the
provided `dockerfile`.
The following `--build-arg` parameters are provided to enable convenient access
to Nexus:

* nexusUrl=${NEXUS_URL}
* nexusUsername=Escaped(${NEXUS_USERNAME})
* nexusPassword=Escaped(${NEXUS_PASSWORD})
* nexusHost=Host(${NEXUS_URL})
* nexusAuth=${nexusUsername}:$(nexusPassword)
* nexusUrlWithAuth=${nexusUrl.withAuth($nexusAuth)}

The above is adhoc notation meant to be more clear than a bunch of words.
If no nexusUsername/nexusPassword are defined nexusAuth will be empty and
nexusUrlWithAuth is equal to nexusUrl.

By default, the image is named after the component and pushed into the image
stream located in the namespace of the pipeline run.

If link:https://www.aquasec.com/products/container-security/[Aqua security scanning]
is enabled in the cluster, images are scanned and registered in Aqua after
they are pushed to the image stream. JSON and HTML report artifacts are
generated. Further, if there is an open pull request on Bitbucket for the
built branch, a code insight report is attached to the Git commit.

Processes tags specified in the `extra-tags` parameter and adds missing tags to
the images stream in the namespace of the pipeline run.

The following artifacts are generated by the task and placed into `.ods/artifacts/`

* `aquasec-scans/`
  ** `report.html`
  ** `report.json`
* `image-digests/`
  ** `<image-name>.json`
  ** `<image-name>-<tag>.json` for each extra-tag
* `sboms/`
  ** `<image-name>.spdx`


== Parameters

[cols="1,1,2"]
|===
| Parameter | Default | Description

| registry
| image-registry.openshift-image-registry.svc:5000
| Image registry to push image to.


| image-stream
| 
| Reference of the image stream buildah will produce. If not set, the value of `.ods/component` is used.


| extra-tags
| 
| Additional image tags (e.g. 'latest dev') for pushed images. The primary tag is based on the commit sha. Only tags currently missing from the image will be added.


| storage-driver
| vfs
| Set buildah storage driver.


| dockerfile
| ./docker/Dockerfile
| Path to the Dockerfile to build (relative to `docker-dir`).


| docker-dir
| .
| Path to the directory to use as Docker context.


| format
| oci
| The format of the built container, `oci` or `docker`.


| buildah-build-extra-args
| 
| Extra parameters passed for the build command when building images (e.g. '--build-arg=firstArg=one --build-arg=secondArg=two').


| buildah-push-extra-args
| 
| Extra parameters passed for the push command when pushing images.


| trivy-sbom-extra-args
| 
| Extra parameters passed for the trivy command to generate an SBOM.


| aqua-gate
| false
| Whether the Aqua security scan needs to pass for the task to succeed.

|===

== Results

[cols="1,3"]
|===
| Name | Description

| image-digest
| Digest of the image just built.

|===
