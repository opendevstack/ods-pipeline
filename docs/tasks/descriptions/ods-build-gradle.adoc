Builds Gradle applications.

The gradle build by default caches the downloaded version of the gradle wrapper and dependencies in the cache location of
the PVC by setting the environment variable `GRADLE_USER_HOME` to `/workspace/source/.ods-cache/deps/gradle`. 

The following steps are executed:

- build gradle application, using `gradlew clean build`, which includes tests execution and coverage report generation
- SonarQube quality scan

Notes:

- tests exclude the vendor directory.
- test results are converted into xUnit format.

Available environment variables:

- `ODS_OUTPUT_DIR`: this environment variable points to the folder
that this build expects generated application artifacts to be copied to.
The gradle script should read it and copy there the generated artifacts.
- `NEXUS_*` env vars: `NEXUS_URL`, `NEXUS_USERNAME` and `NEXUS_PASSWORD`
are available and should be read by the gradle script.

To enable the gradle script to copy the generated application artifacts script follow these steps:

- read the environment variable `ODS_OUTPUT_DIR` in the buildscript section of the gradle script:
```
buildscript {
    ext {
      outputDir = System.getenv('ODS_OUTPUT_DIR')
    }
}
```
- customize the jar tasks to set the destination directory
```
jar {
    println("Set application jar name to 'app'")
    archiveBaseName = 'app'
    if (outputDir != null) {
        println("Set destinationDirectory to '${projectDir}/${outputDir}'")
        destinationDirectory = file("${projectDir}/${outputDir}")
    }
}
```

To create a coverage report be sure that you add to `gradle.properties` the required
configuration. For example to enable Jacoco coverage repot you will need to:

- add `jacoco` plugin:
```
plugins {
    id 'application'
    id 'jacoco'
}
```
- add task `jacocoTestReport`:
```
jacocoTestReport {
    reports {
        xml.required = true
    }
}
```
- add `finalizedBy jacocoTestReport` to the task `test`:
```
tasks.named('test') {
    useJUnitPlatform()
    finalizedBy jacocoTestReport
}
```

The exact build recipe can be found at
link:https://github.com/opendevstack/ods-pipeline/blob/master/build/package/scripts/build-gradle.sh[build/package/scripts/build-gradle.sh].

After tests ran successfully, the application source code is scanned by SonarQube.
Default SonarQube project properties are provided unless `sonar-project.properties`
is present.
When `sonar-quality-gate` is set to `true`, the task will fail if the quality gate
is not passed. If SonarQube is not desired, it can be disabled via `sonar-skip`.
The SonarQube scan will include parameters to perform a pull request analysis if
there is an open pull request for the branch being built. If the
link:https://docs.sonarqube.org/latest/analysis/bitbucket-integration/[ALM integration]
is setup properly, pull request decoration in Bitbucket is done automatically.

The following artifacts are generated by the build task and placed into `.ods/artifacts/`

* `code-coverage/`
  ** `coverage.xml`
* `sonarqube-analysis/`
  ** `analysis-report.md`
  ** `issues-report.csv`
  ** `quality-gate.json`
* `xunit-reports/`
  ** `report.xml`

Instead of the built-in script, one can also specify a build script located
in the Git repository using the `build-script` task parameter. This allows
full control of building and testing, including any generation of artifacts.
Note that some other task parameters have no effect when a custom build
script is used, unless they are handled properly in the script. At a
minimum, the custom script should place its outputs in the directory
identified by `output-dir`.
