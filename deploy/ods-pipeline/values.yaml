# -----------------------  Installation hint  -----------------------
#                          !!! Important !!!
#  This is the default values file - if you're editing this as
#  part of the ODS pipeline installation you're in the wrong file!
#
#  Please open ../values.yaml (the file you have created by making
#  a copy of ../values.yaml.tmpl) and do your changes there.
# -----------------------  Installation hint  -----------------------

# ####################################### #
# UMBRELLA                                #
# ####################################### #
global:
  # Image tag to use for images referenced by tasks (defaults to the chart appVersion).
  # imageTag: ''
  # Suffix to append to the task name. If not set, the sufix will be computed
  # from the chart appVersion in the form "-vMAJOR-MINOR-PATCH".
  # taskSuffix: -latest
  # Custom task kind (defaults to "Task")
  # taskKind: "ClusterTask"
  # enabledTasks controls which tasks will be installed. Set the tasks you do
  # not want to install to false.
  enabledTasks:
    buildGo: true
    buildGradle: true
    buildPython: true
    buildNPM: true
    packageImage: true
    deployHelm: true



# ####################################### #
# SETUP CHART CONFIG                      #
# ####################################### #
setup:
  # enable configuration and management chart
  enabled: true

  # General
  # Serviceaccount name to use for pipeline resources.
  serviceAccountName: 'pipeline'
  # Whether to enable debug mode
  debug: 'false'

  # Bitbucket
  # Bitbucket URL (including scheme, without trailing slash).
  # Example: https://bitbucket.example.com.
  bitbucketUrl: ''
  # Bitbucket username. Example: cd_user.
  bitbucketUsername: ''

  # Nexus
  # Nexus URL (including scheme, without trailing slash).
  # Example: https://nexus.example.com.
  nexusUrl: ''
  # Nexus username. Example: developer.
  nexusUsername: ''

  # Sonar
  # SonarQube URL (including scheme, without trailing slash).
  # Example: https://sonarqube.example.com.
  sonarUrl: ''
  # SonarQube edition. Valid options: 'community', 'developer', 'enterprise' or 'datacenter'
  sonarEdition: 'community'

  # Aqua
  # Aqua URL (including scheme, without trailing slash).
  # Example: https://aqua.example.com.
  # Leave empty when not using Aqua.
  aquaUrl: ''
  # Aqua registry name.
  # Leave empty when not using Aqua.
  aquaRegistry: ''
  # Aqua username. Example: developer.
  # Leave empty when not using Aqua.
  aquaUsername: ''

  # Cluster
  # URL (including scheme, without trailing slash) of the OpenShift Web Console.
  consoleUrl: 'http://example.com'

  # Notification Webhook
  notification:
    # Whether notifications should be sent to the URL specified below or not.
    enabled: false
    # URL of the configured webhook
    url: 'http://example.com'
    # The HTTP method to be used
    method: 'POST'
    # The HTTP content type header
    contentType: 'application/json'
    # Specify the outcomes you want to be notified of (allowed values: c.f.
    # https://tekton.dev/docs/pipelines/pipelines/#using-aggregate-execution-status-of-all-tasks)
    notifyOnStatus:
      - 'Failed'
    # Template to be processed and accepted by the configured webhook in use
    # Below example might work for Microsoft Teams
    requestTemplate: |-
      {
        "@type": "MessageCard",
        "@context": "http://schema.org/extensions",
        "themeColor": {{if eq .OverallStatus "Succeeded"}}"237b4b"{{else}}"c4314b"{{ end }},
        "summary": "{{.ODSContext.Project}} - ODS Pipeline Run {{.PipelineRunName}} finished with status {{.OverallStatus}}",
        "sections": [
          {
            "activityTitle": "ODS Pipeline Run {{.PipelineRunName}} finished with status {{.OverallStatus}}",
            "activitySubtitle": "On Project {{.ODSContext.Project}}",
            "activityImage": "https://avatars.githubusercontent.com/u/38974438?s=200&v=4",
            "facts": [
              {
                "name": "GitRef",
                "value": "{{.ODSContext.GitRef}}"
              }
            ],
            "markdown": true
          }
        ],
        "potentialAction": [
          {
            "@type": "OpenUri",
            "name": "Go to PipelineRun",
            "targets": [
              {
                "os": "default",
                "uri": "{{.PipelineRunURL}}"
              }
            ]
          }
        ]
      }

  # Pipeline(Run) Pruning
  # Minimum hours to keep a pipeline run. Has precendence over pipelineRunMaxKeepRuns.
  # Must be at least 1.
  pipelineRunMinKeepHours: '48'
  # Maximum number of pipeline runs to keep.
  # Must be at least 1.
  pipelineRunMaxKeepRuns: '20'

  # Pipeline Manager
  pipelineManager:
    # PVC (used for the pipeline workspace)
    # Storage provisioner. On AWS backed clusters, use 'kubernetes.io/aws-ebs'.
    storageProvisioner: 'kubernetes.io/aws-ebs'
    # Storage class. On AWS backed clusters, use 'gp2'.
    storageClassName: 'gp2'
    # Storage size. Defaults to 2Gi unless set explicitly here.
    storageSize: '5Gi'
    # Number of replicas to run for the pipeline manager.
    replicaCount: 1
    # Repository from which to pull the pipeline manager container image.
    imageRepository: ghcr.io/opendevstack/ods-pipeline
    # Deployment pod resources. Typically these settings should not need to change.
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi



# ####################################### #
# TASK CHART CONFIG                       #
# ####################################### #
tasks:
  # enable task definition chart
  enabled: true

  # Image repository to pull task images from.
  imageRepository: ghcr.io/opendevstack/ods-pipeline

  # Custom task prefix (defaults to "ods")
  # taskPrefix: "foo"

  # Registry to push images to from ods-package-image task.
  pushRegistry: image-registry.openshift-image-registry.svc:5000

  # To define build task specific sidecars and quotas, add resources/sidecar section(s) per task,
  # e.g.
  #
  # go:
  #   # define custom resource quotas for the go build task
  #   resources:
  #     limits:
  #       cpu: 100m
  #       memory: 128Mi
  #     requests:
  #       cpu: 100m
  #       memory: 128Mi
  #   sidecars:
  #     # sidecars added to go build task
  #     - workspaces: null
  #       image: postgres
  #       name: postgres-sidecar
  #       resources:
  #         limits:
  #           cpu: 100m
  #           memory: 128Mi
  #         requests:
  #           cpu: 100m
  #           memory: 128Mi
