apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  creationTimestamp: null
  labels:
    pipeline.opendevstack.org/git-ref: main
    pipeline.opendevstack.org/repository: foo-bar
    pipeline.opendevstack.org/stage: dev
  name: bar-main
spec:
  description: ODS
  finally:
  - name: go-helm-finalize
    taskRef:
      kind: Task
      name: ods-finalize-docgen-v0-1-0
    workspaces:
    - name: source
      workspace: shared-workspace
  - name: ods-finish
    params:
    - name: pipeline-run-name
      value: $(context.pipelineRun.name)
    - name: aggregate-tasks-status
      value: $(tasks.status)
    taskRef:
      kind: ClusterTask
      name: ods-finish-v0-1-0
    workspaces:
    - name: source
      workspace: shared-workspace
  params:
  - default: foo-bar
    name: repository
    type: string
  - default: foo
    name: project
    type: string
  - default: bar
    name: component
    type: string
  - default: https://bitbucket.acme.org/scm/foo/bar.git
    name: git-repo-url
    type: string
  - default: refs/heads/main
    name: git-full-ref
    type: string
  - default: "0"
    name: pr-key
    type: string
  - default: ""
    name: pr-base
    type: string
  - default: ""
    name: environment
    type: string
  - default: ""
    name: version
    type: string
  tasks:
  - name: ods-start
    params:
    - name: url
      value: $(params.git-repo-url)
    - name: git-full-ref
      value: $(params.git-full-ref)
    - name: project
      value: $(params.project)
    - name: pr-key
      value: $(params.pr-key)
    - name: pr-base
      value: $(params.pr-base)
    - name: pipeline-run-name
      value: $(context.pipelineRun.name)
    - name: environment
      value: $(params.environment)
    - name: version
      value: $(params.version)
    taskRef:
      kind: ClusterTask
      name: ods-start-v0-1-0
    workspaces:
    - name: source
      workspace: shared-workspace
  - name: go-helm-build
    params:
    - name: DOCKER_CONTEXT
      value: docker
    - name: TLSVERIFY
      value: "false"
    - name: IMAGE_STREAM
      value: go-helm
    runAfter:
    - ods-start
    taskRef:
      kind: ClusterTask
      name: ods-build-go-v0-1-0
    workspaces:
    - name: source
      workspace: shared-workspace
  - name: go-helm-deploy
    params:
    - name: RELEASE_NAME
      value: go-helm
    - name: RELEASE_NAMESPACE
      value: $(params.project)-dev
    - name: PROJECT
      value: $(params.project)
    - name: REPOSITORY
      value: michael-go-helm
    - name: NAMESPACE
      value: $(params.namespace)
    runAfter:
    - go-helm-build
    taskRef:
      kind: ClusterTask
      name: ods-deploy-helm-v0-1-0
    workspaces:
    - name: source
      workspace: shared-workspace
  workspaces:
  - name: shared-workspace
